<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Chat RH â€“ Canal de DenÃºncias</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { background: #f5f7fa; font-family: Arial, sans-serif;}
        .card { max-width: 500px; margin: 60px auto; padding: 38px 30px; background: #fff; border-radius: 14px; box-shadow: 0 2px 16px #0001;}
        h3 { text-align:center; color: #1a355e; font-weight:600;}
        .info-status { margin-bottom: 18px; color:#1a355e; font-size:1.07rem;}
        .chat-container { background: #f8fafc; border: 1px solid #e4e9f2; border-radius: 8px; max-height: 260px; overflow-y: auto; padding: 12px 12px 6px 12px; margin-bottom: 18px;}
        .chat-msg { margin-bottom: 10px; padding: 8px 12px; border-radius: 8px; max-width: 88%; clear: both; word-break: break-word;}
        .chat-user { background: #e7f4fd; color: #125; float: right; text-align: right;}
        .chat-rh { background: #e3f9e7; color: #174821; float: left; text-align: left;}
        .chat-author { font-weight: bold; font-size: 0.92em; margin-right: 6px;}
        .chat-date { font-size: 0.85em; color: #888; margin-left: 8px;}
        .chat-form { display: flex; gap: 10px; margin-top: 10px; align-items: center;}
        .chat-form input[type="text"] { flex: 2; margin: 0;}
        .chat-form input[type="file"] { flex: 1;}
        .chat-form button { background: #49b87a; color: #fff; border: none; border-radius: 8px; padding: 8px 18px; font-weight: bold; cursor: pointer; transition: background .2s; box-shadow: 0 2px 6px #49b87a2c;}
        .chat-form button:hover { background: #32995f;}
        .chat-anexo-link { display: inline-block; margin: 5px 0 0 0; font-size: 0.95em; color: #207a52; text-decoration: underline;}
        .clearfix::after { content: ""; display: table; clear: both;}
        .voltar-link { display:block; margin:28px auto 0 auto; color:#29599a; text-align:center; text-decoration:underline;}
        @media (max-width:600px) {
            .card {padding: 20px 5vw;}
        }
    </style>
</head>
<body>
    <div class="card">
        <h3>Chat â€“ Protocolo {{ denuncia.protocolo }}</h3>
        <div class="info-status">
            <b>Status:</b> {{ denuncia.status }}<br>
            <b>Data de envio:</b> {{ denuncia.data_hora.strftime('%d/%m/%Y %H:%M') }}
        </div>
        <div class="chat-container clearfix">
            {% if mensagens %}
                {% for m in mensagens %}
                    <div class="chat-msg {% if m.autor == 'UsuÃ¡rio' %}chat-user{% else %}chat-rh{% endif %}">
                        <span class="chat-author">{{ m.autor }}:</span>
                        {{ m.texto }}
                        {% if m.anexo %}
                            <br>
                            <a href="{{ url_for('chat_arquivo', filename=m.anexo) }}" target="_blank" class="chat-anexo-link">ðŸ“Ž Anexo</a>
                        {% endif %}
                        <span class="chat-date">{{ m.data_hora.strftime('%d/%m %H:%M') }}</span>
                    </div>
                {% endfor %}
            {% else %}
                <div style="color:#888;text-align:center;">Nenhuma mensagem ainda.</div>
            {% endif %}
            <div class="clearfix"></div>
        </div>
        <form method="post" enctype="multipart/form-data" class="chat-form">
            <input type="text" name="mensagem" placeholder="Digite sua mensagem..." maxlength="500" autocomplete="off">
            <input type="file" name="anexo" accept="image/*,.pdf,.doc,.docx,.xls,.xlsx,.png,.jpg,.jpeg">
            <button type="submit">Enviar</button>
        </form>
        <a href="{{ url_for('admin') }}" class="voltar-link">Voltar para painel</a>
    </div>
</body>
</html>
