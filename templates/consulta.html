<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Consulta de Denúncias</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
  <div class="container">
    <h1>Consulta de Denúncias</h1>

    <!-- Formulário de busca de protocolo -->
    <form method="post" action="{{ url_for('consulta') }}" class="consulta-form">
      <input
        type="text"
        name="protocolo"
        placeholder="Digite o protocolo"
        value="{{ protocolo or '' }}"
        required
        style="margin-right: 8px;"
      >
      <button type="submit" class="btn">Buscar</button>
    </form>

    {% if denuncia %}
      <hr>

      <h2>Protocolo: {{ denuncia.protocolo }}</h2>

      <!-- Formulário de chat -->
      <form
        id="chatForm"
        method="post"
        action="{{ url_for('chat', protocolo=denuncia.protocolo) }}"
        class="chat-form"
        autocomplete="off"
        enctype="multipart/form-data"
      >
        <input type="hidden" name="protocolo" value="{{ denuncia.protocolo }}">

        <input
          type="text"
          name="mensagem"
          placeholder="Digite sua mensagem..."
          maxlength="500"
          autocomplete="off"
          style="width: 100%; margin-bottom: 8px;"
        >

        <div style="display: flex; gap: 12px; margin-bottom: 8px;">
          <label for="file-upload-user" class="btn-azul">Anexar Documento</label>
          <input
            type="file"
            id="file-upload-user"
            name="anexo"
            class="input-file"
            accept="image/*,audio/*,video/*,.pdf,.doc,.docx,.xls,.xlsx"
            onchange="showFilenameUser()"
            style="display: none;"
          >
          <div id="filename-user" style="font-style: italic;"></div>

          <button type="button" class="btn-azul" onclick="abrirGravadorAudio()">Gravar Áudio</button>
        </div>

        <button type="submit" class="btn-verde">Enviar</button>
      </form>
    {% endif %}
  </div>

  <script>
    function showFilenameUser() {
      const input = document.getElementById('file-upload-user');
      const label = document.getElementById('filename-user');
      label.textContent = input.files.length ? input.files[0].name : '';
    }
    function abrirGravadorAudio() {
      alert("Funcionalidade de gravação de áudio aqui!");
    }
  </script>
</body>
</html>
