{% extends "base.html" %}
{% block title %}Consulta de Denúncias{% endblock %}

{% block content %}
<div class="container mt-5">
  <h1 class="mb-4">Consulta de Denúncias</h1>

  <!-- Busca de protocolo -->
  <form method="post" action="{{ url_for('consulta') }}" class="form-inline mb-4">
    <input
      type="text"
      name="protocolo"
      class="form-control mr-2"
      placeholder="Digite o protocolo"
      value="{{ protocolo or '' }}"
      required
    >
    <button type="submit" class="btn btn-primary">Buscar</button>
  </form>

  {% if denuncia %}
    <hr>

    <h2 class="mb-3">Protocolo: {{ denuncia.protocolo }}</h2>

    <!-- Chat / Formulário de resposta -->
    <form
      id="chatForm"
      method="post"
      action="{{ url_for('chat', protocolo=denuncia.protocolo) }}"
      class="chat-form"
      autocomplete="off"
      enctype="multipart/form-data"
    >
      <input type="hidden" name="protocolo" value="{{ denuncia.protocolo }}">

      <div class="form-group mb-2">
        <input
          type="text"
          name="mensagem"
          class="form-control"
          placeholder="Digite sua mensagem..."
          maxlength="500"
          required
        >
      </div>

      <div class="form-row align-items-center mb-3">
        <div class="col-auto">
          <label class="btn btn-secondary mb-0">
            Anexar Documento
            <input type="file" name="anexo" class="d-none" accept="*/*">
          </label>
        </div>
        <div class="col-auto">
          <button type="button" class="btn btn-secondary" onclick="abrirGravadorAudio()">Gravar Áudio</button>
        </div>
      </div>

      <button type="submit" class="btn btn-success">Enviar</button>
    </form>
  {% endif %}
</div>

<script>
  function abrirGravadorAudio() {
    alert("Funcionalidade de gravação de áudio aqui!");
  }
</script>
{% endblock %}
